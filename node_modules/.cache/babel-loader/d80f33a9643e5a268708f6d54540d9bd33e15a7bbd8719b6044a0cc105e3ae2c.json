{"ast":null,"code":"// src/components/Chat.js\nimport React,{useEffect,useState,useContext}from'react';import{Container,Typography,TextField,Button,List,ListItem,ListItemText,Box}from'@mui/material';import axios from'axios';import{useParams}from'react-router-dom';import{AuthContext}from'../context/AuthContext';import io from'socket.io-client';// Use environment variable for Socket.IO connection\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(process.env.REACT_APP_BACKEND_URL);const Chat=()=>{const{chatId}=useParams();const{user}=useContext(AuthContext);const[chat,setChat]=useState(null);const[message,setMessage]=useState('');const[messages,setMessages]=useState([]);useEffect(()=>{const fetchChat=async()=>{try{const response=await axios.get(`${process.env.REACT_APP_BACKEND_URL}/api/chats/${chatId}`,{headers:{'x-auth-token':localStorage.getItem('token')}});setChat(response.data);setMessages(response.data.messages);}catch(err){console.error(err);}};fetchChat();socket.emit('joinChat',chatId);socket.on('receiveMessage',newMessage=>{setMessages(prevMessages=>[...prevMessages,newMessage]);});return()=>{socket.off('receiveMessage');};},[chatId]);const handleSendMessage=()=>{if(message.trim()){socket.emit('sendMessage',{chatId,message,senderId:user.id});setMessage('');}};if(!chat)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});return/*#__PURE__*/_jsxs(Container,{maxWidth:\"md\",style:{marginTop:'2rem'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",gutterBottom:true,children:[\"Chat with \",user.role==='client'?chat.worker.username:chat.client.username]}),/*#__PURE__*/_jsx(Box,{sx:{maxHeight:'400px',overflowY:'auto',border:'1px solid #ccc',padding:'1rem'},children:/*#__PURE__*/_jsx(List,{children:messages.map((msg,index)=>/*#__PURE__*/_jsx(ListItem,{sx:{justifyContent:msg.sender._id===user.id?'flex-end':'flex-start'},children:/*#__PURE__*/_jsx(Box,{sx:{backgroundColor:msg.sender._id===user.id?'#1976d2':'#e0e0e0',color:msg.sender._id===user.id?'white':'black',padding:'0.5rem 1rem',borderRadius:'10px',maxWidth:'60%'},children:/*#__PURE__*/_jsx(ListItemText,{primary:msg.message,secondary:`From: ${msg.sender._id===user.id?'You':msg.sender.username}`})})},index))})}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:'1rem',marginTop:'1rem'},children:[/*#__PURE__*/_jsx(TextField,{label:\"Message\",fullWidth:true,value:message,onChange:e=>setMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSendMessage()}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSendMessage,children:\"Send\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useEffect","useState","useContext","Container","Typography","TextField","Button","List","ListItem","ListItemText","Box","axios","useParams","AuthContext","io","jsx","_jsx","jsxs","_jsxs","socket","process","env","REACT_APP_BACKEND_URL","Chat","chatId","user","chat","setChat","message","setMessage","messages","setMessages","fetchChat","response","get","headers","localStorage","getItem","data","err","console","error","emit","on","newMessage","prevMessages","off","handleSendMessage","trim","senderId","id","children","maxWidth","style","marginTop","variant","gutterBottom","role","worker","username","client","sx","maxHeight","overflowY","border","padding","map","msg","index","justifyContent","sender","_id","backgroundColor","color","borderRadius","primary","secondary","display","gap","label","fullWidth","value","onChange","e","target","onKeyPress","key","onClick"],"sources":["/Users/macm1/Documents/JobSkill-App/frontend/src/components/Chat.js"],"sourcesContent":["// src/components/Chat.js\nimport React, { useEffect, useState, useContext } from 'react';\nimport { Container, Typography, TextField, Button, List, ListItem, ListItemText, Box } from '@mui/material';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport { AuthContext } from '../context/AuthContext';\nimport io from 'socket.io-client';\n\n// Use environment variable for Socket.IO connection\nconst socket = io(process.env.REACT_APP_BACKEND_URL);\n\nconst Chat = () => {\n  const { chatId } = useParams();\n  const { user } = useContext(AuthContext);\n  const [chat, setChat] = useState(null);\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState([]);\n\n  useEffect(() => {\n    const fetchChat = async () => {\n      try {\n        const response = await axios.get(`${process.env.REACT_APP_BACKEND_URL}/api/chats/${chatId}`, {\n          headers: { 'x-auth-token': localStorage.getItem('token') },\n        });\n        setChat(response.data);\n        setMessages(response.data.messages);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n    fetchChat();\n\n    socket.emit('joinChat', chatId);\n\n    socket.on('receiveMessage', (newMessage) => {\n      setMessages((prevMessages) => [...prevMessages, newMessage]);\n    });\n\n    return () => {\n      socket.off('receiveMessage');\n    };\n  }, [chatId]);\n\n  const handleSendMessage = () => {\n    if (message.trim()) {\n      socket.emit('sendMessage', { chatId, message, senderId: user.id });\n      setMessage('');\n    }\n  };\n\n  if (!chat) return <div>Loading...</div>;\n\n  return (\n    <Container maxWidth=\"md\" style={{ marginTop: '2rem' }}>\n      <Typography variant=\"h4\" gutterBottom>\n        Chat with {user.role === 'client' ? chat.worker.username : chat.client.username}\n      </Typography>\n      <Box sx={{ maxHeight: '400px', overflowY: 'auto', border: '1px solid #ccc', padding: '1rem' }}>\n        <List>\n          {messages.map((msg, index) => (\n            <ListItem key={index} sx={{ justifyContent: msg.sender._id === user.id ? 'flex-end' : 'flex-start' }}>\n              <Box\n                sx={{\n                  backgroundColor: msg.sender._id === user.id ? '#1976d2' : '#e0e0e0',\n                  color: msg.sender._id === user.id ? 'white' : 'black',\n                  padding: '0.5rem 1rem',\n                  borderRadius: '10px',\n                  maxWidth: '60%',\n                }}\n              >\n                <ListItemText primary={msg.message} secondary={`From: ${msg.sender._id === user.id ? 'You' : msg.sender.username}`} />\n              </Box>\n            </ListItem>\n          ))}\n        </List>\n      </Box>\n      <Box sx={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\n        <TextField\n          label=\"Message\"\n          fullWidth\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n        />\n        <Button variant=\"contained\" color=\"primary\" onClick={handleSendMessage}>\n          Send\n        </Button>\n      </Box>\n    </Container>\n  );\n};\n\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}